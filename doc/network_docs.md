Here are my thoughts on network code design, inspired partially by quakeworld.

Primary unit of communication is the command

on a high level, consumer code deals only with commands sent and received.

a level below is the tremor channel protocol which organizes semi-reliable data transmission over UDP.

```
0       7 8      15      23 24    31                            
+--------+--------+--------+--------+
R        sequence number            |
+--------+--------+--------+--------+
|                ACK                |
+--------+--------+--------+--------+
|       ID        |cmdcount|        |
+--------+--------+--------+--------+
|             Commands...           |
```
R - packet contains reliable commands

sequence number - 31-bit packet identifier, increment by 1 on each sent UDP packet

ACK - last received sequence number, for detecting packet loss

ID - random identifier generated by client at startup, keep track of client connection even when UDP port changes

cmdcount - number of commands contained in this packet

Commands... - payload

Commands can be reliable or unreliable